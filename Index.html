<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>VoltSphere</title>
  <style>
    /* --- (Styles: nav, buttons, toggles, modals, containers) --- */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:Arial,sans-serif; transition:0.3s; background:#f4f4f4; }
    .nav { display:flex; gap:1rem; padding:1rem; background:#fff; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .nav a { cursor:pointer; text-decoration:none; color:#333; font-weight:500; }
    .nav a.active { color:#0077cc; }
    .container { padding:2rem; }
    h1,h2,h3 { margin-bottom:1rem; }
    .btn { padding:0.7rem 1.5rem; background:#0077cc; color:#fff; border:none;border-radius:5px;
           cursor:pointer; transition:0.2s; } .btn:hover { background:#005fa3; }
    .toggle { display:flex; align-items:center; gap:0.5rem; padding:0.5rem; border:2px solid #0077cc;
              border-radius:30px; width:max-content; cursor:pointer; }
    .toggle input { display:none; }
    .toggle span { width:40px; height:20px; background:#ccc; border-radius:10px; position:relative;
                   transition:0.2s; }
    .toggle span::before { content:""; width:18px; height:18px; background:#fff; border-radius:50%;
                          position:absolute; top:1px; left:1px; transition:0.2s; }
    .toggle input:checked + span { background:#0077cc; }
    .toggle input:checked + span::before { transform:translateX(20px); }
    .modal-outer { position:fixed; top:0;left:0; width:100%;height:100%; display:none;
                   align-items:center; justify-content:center; background:rgba(0,0,0,0.5); }
    .modal { background:#fff;padding:2rem;border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
    .hidden { display:none; }
    table {border-collapse:collapse;width:100%;margin-top:1rem;}
    table, th, td {border:1px solid #ccc;padding:0.5rem;text-align:center;}
  </style>
</head>
<body>

  <!-- Navigation -->
  <div class="nav">
    <a class="nav-link active" data-page="home">Home</a>
    <a class="nav-link" data-page="simulation">Simulation</a>
    <a class="nav-link" data-page="services">Services</a>
    <a class="nav-link" data-page="about">About</a>
    <a class="nav-link" data-page="contact">Contact</a>
  </div>

  <!-- Modal for Login -->
  <div id="loginModal" class="modal-outer">
    <div class="modal">
      <h3>Login Required</h3>
      <p>You've reached 3 free uses. Please enter your email to continue:</p>
      <input type="email" id="loginEmail" placeholder="Email address" />
      <button id="loginSubmit" class="btn">Continue</button>
    </div>
  </div>

  <!-- Containers for each page -->
  <div id="home" class="container page">
    <h1>Welcome to VoltSphere</h1>
    <p>Pioneering the future of energy with smart simulation.</p>
  </div>

  <div id="simulation" class="container page hidden">
    <h1>üîã Microgrid Simulator</h1>
    <div>
      <label>Battery Capacity (kWh):
        <input type="range" id="batteryCap" min="0" max="50" value="10" />
        <span id="batteryCapVal">10</span>
      </label>
    </div>
    <div>
      <label>Battery Efficiency (%):
        <input type="range" id="batteryEff" min="50" max="100" value="90" />
        <span id="batteryEffVal">90</span>
      </label>
    </div>
    <div class="toggle">
      <input type="checkbox" id="solarToggle" checked />
      <span></span>
      <label for="solarToggle">‚òÄÔ∏è Solar Power</label>
    </div>
    <button id="simulateBtn" class="btn">üîÑ Reset Simulation</button>
    <p id="usageMsg"></p>
    <canvas id="chartCanvas" class="hidden"></canvas>
    <p id="totalCost"></p>
    <button id="downloadCsv" class="btn hidden">üì• Download Data CSV</button>
  </div>

  <div id="services" class="container page hidden">
    <h1>üõ† Our Services</h1>
    <ul>
      <li>MicrogridSim API</li>
      <li>Custom Energy Solutions</li>
      <li>Consulting & Analysis</li>
    </ul>
  </div>

  <div id="about" class="container page hidden">
    <h1>About Us</h1>
    <p>VoltSphere empowers communities with clean, smart energy tools!</p>
  </div>

  <div id="contact" class="container page hidden">
    <h1>Contact Us</h1>
    <form id="contactForm">
      <input type="text" id="contactName" placeholder="Name" required /><br/><br/>
      <input type="email" id="contactEmail" placeholder="Email" required /><br/><br/>
      <textarea id="contactMessage" placeholder="Message" required></textarea><br/><br/>
      <button type="submit" class="btn">Send Message</button>
    </form>
    <p id="contactReply"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Navigation logic
    document.querySelectorAll('.nav-link').forEach(link => {
      link.onclick = () => {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById(link.dataset.page).classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
        link.classList.add('active');
      };
    });

    // State
    let uses = 0, userEmail = null;

    // DOM refs
    const batteryCap = document.getElementById('batteryCap');
    const batteryCapVal = document.getElementById('batteryCapVal');
    const batteryEff = document.getElementById('batteryEff');
    const batteryEffVal = document.getElementById('batteryEffVal');
    const solarToggle = document.getElementById('solarToggle');
    const simulateBtn = document.getElementById('simulateBtn');
    const usageMsg = document.getElementById('usageMsg');
    const totalCost = document.getElementById('totalCost');
    const downloadCsv = document.getElementById('downloadCsv');
    const chartCanvas = document.getElementById('chartCanvas');

    // Update displays
    batteryCap.oninput = () => batteryCapVal.textContent = batteryCap.value;
    batteryEff.oninput = () => batteryEffVal.textContent = batteryEff.value;

    // Simulation logic
    simulateBtn.onclick = () => {
      if ((!userEmail && uses >= 3)) {
        document.getElementById('loginModal').style.display = 'flex';
        return;
      }

      simulateBtn.disabled = true;
      uses++;

      const cap = parseFloat(batteryCap.value);
      const eff = parseFloat(batteryEff.value)/100;
      const useSolar = solarToggle.checked;
      const hours = 24;
      let battery = 0;
      let storage = [], grid = [], costArr = [], solarArr = [];
      const loadArr = Array(24).fill().map((_,i)=> (i<6 ?2:i<10?3:i<16?4:i<20?3:2));

      for (let i=0;i<hours;i++) {
        const sol = useSolar && i>=6 && i<=14 ? [2,3,4,5,5,5,4,3,2][i-6] : 0;
        const load = loadArr[i];
        let net = sol - load;
        let gridUse, charge;
        if (net>=0) { charge = net*eff; battery = Math.min(battery+charge,cap); gridUse=0; }
        else {
          const need = -net;
          if (battery>=need) { battery -= need/eff; gridUse=0; }
          else { gridUse=need-battery; battery=0; }
        }
        storage.push(battery); grid.push(gridUse); solarArr.push(sol);
        costArr.push(gridUse*0.15);
      }

      // Chart
      chartCanvas.classList.remove('hidden');
      const ctx = chartCanvas.getContext('2d');
      new Chart(ctx, {
        type:'line',
        data:{
          labels:Array.from({length:24},(_,i)=>i),
          datasets:[
            useSolar ? {label:'Solar (kW)', data:solarArr, borderColor:'gold', fill:false} : null,
            {label:'Load (kW)', data:loadArr, borderColor:'blue', fill:false},
            {label:'Battery (kWh)', data:storage, borderColor:'green', fill:false},
            {label:'Grid (kW)', data:grid, borderColor:'red', fill:false},
          ].filter(Boolean)
        }
      });

      // Cost & Messaging
      const total = costArr.reduce((a,b)=>a+b,0);
      totalCost.textContent = `Total grid cost: $${total.toFixed(2)}`;
      usageMsg.textContent = userEmail ? `Welcome, ${userEmail}!` :
        `‚úÖ You have ${Math.max(3-uses,0)} free simulation${uses<3?'s':''} left.`;

      downloadCsv.classList.remove('hidden');
      const csvContent = ['Hour,Solar,Load,Battery,Grid,Cost']
        .concat(Array.from({length:24},(_,i)=>`${i},${solarArr[i]},${loadArr[i]},${storage[i]},${grid[i]},${costArr[i]}`))
        .join('\n');
      downloadCsv.onclick = () => {
        const a = document.createElement('a');
        a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
        a.download = 'simulation.csv';
        a.click();
      };

      simulateBtn.disabled = false;
    };

    // Login submit
    document.getElementById('loginSubmit').onclick = () => {
      const em = document.getElementById('loginEmail').value.trim();
      if (!em) return alert('Enter valid email.');
      userEmail = em;
      document.getElementById('loginModal').style.display = 'none';
      simulateBtn.click();
    };

    // Contact form
    document.getElementById('contactForm').onsubmit = evt => {
      evt.preventDefault();
      document.getElementById('contactReply').textContent = 'üì® Thanks, we received your message!';
      evt.target.reset();
    };
  </script>
</body>
</html>
